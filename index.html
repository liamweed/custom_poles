<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>twIIgs — Design Your Poles</title>
<link href="https://fonts.googleapis.com/css2?family=Anton&family=Barlow:wght@400;500;600&family=Barlow+Condensed:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  /* =============================================
     ROOT VARIABLES & RESET
     ============================================= */
  :root {
    --bg: #F5F0E8;
    --bg-dark: #1A1A1A;
    --ink: #1A1A1A;
    --ink-mid: #555;
    --ink-light: #999;
    --white: #FFFFFF;
    --accent: #D94F3D;
    --radius-sm: 4px;
    --radius-md: 10px;
    --radius-lg: 20px;
    --shadow: 0 2px 12px rgba(0,0,0,0.12);
    --shadow-lg: 0 8px 40px rgba(0,0,0,0.18);
    --transition: 0.2s ease;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  html { scroll-behavior: smooth; }
  body {
    font-family: 'Barlow', sans-serif;
    background: var(--bg);
    color: var(--ink);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* =============================================
     SCREEN MANAGEMENT
     ============================================= */
  .screen { display: none; min-height: 100vh; flex-direction: column; }
  .screen.active { display: flex; }

  /* =============================================
     SHARED COMPONENTS
     ============================================= */
  .logo {
    font-family: 'Anton', sans-serif;
    font-size: 1.1rem;
    letter-spacing: 0.15em;
    color: var(--ink);
    text-transform: uppercase;
  }
  .logo span { color: var(--accent); }

  .btn {
    display: inline-block;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 1rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    padding: 14px 36px;
    border-radius: 4px;
    border: 2px solid var(--ink);
    background: var(--ink);
    color: var(--white);
    cursor: pointer;
    transition: all var(--transition);
    user-select: none;
  }
  .btn:hover { background: transparent; color: var(--ink); }
  .btn.btn-outline {
    background: transparent;
    color: var(--ink);
  }
  .btn.btn-outline:hover { background: var(--ink); color: var(--white); }
  .btn.btn-accent {
    background: var(--accent);
    border-color: var(--accent);
  }
  .btn.btn-accent:hover { background: transparent; color: var(--accent); }

  .step-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.78rem;
    font-weight: 600;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--ink-light);
  }
  .step-title {
    font-family: 'Anton', sans-serif;
    font-size: clamp(1.8rem, 4vw, 2.8rem);
    letter-spacing: 0.04em;
    text-transform: uppercase;
    line-height: 1;
    margin-top: 4px;
  }

  .nav-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 18px 32px;
    border-bottom: 1.5px solid rgba(0,0,0,0.1);
    position: sticky;
    top: 0;
    background: var(--bg);
    z-index: 100;
  }
  .nav-steps {
    display: flex;
    gap: 6px;
    align-items: center;
  }
  .nav-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: rgba(0,0,0,0.15);
    transition: all var(--transition);
  }
  .nav-dot.active { background: var(--ink); width: 24px; border-radius: 4px; }
  .nav-dot.done { background: var(--ink-mid); }

  /* =============================================
     POLE VISUALIZATION
     ============================================= */
  .poles-wrapper {
    display: flex;
    gap: clamp(20px, 5vw, 60px);
    align-items: flex-start;
    justify-content: center;
  }
  .pole-col {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
  }
  .pole-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.72rem;
    font-weight: 600;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    color: var(--ink-mid);
    margin-bottom: 6px;
  }
  .pole-rings {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0;
  }
  .ring {
    border-radius: 999px;
    transition: background-color 0.3s ease;
    position: relative;
  }
  .ring::after {
    content: '';
    position: absolute;
    top: 15%;
    left: 12%;
    width: 35%;
    height: 30%;
    background: rgba(255,255,255,0.2);
    border-radius: 999px;
    pointer-events: none;
  }
  .pole-shaft {
    width: 10px;
    flex: 1;
    min-height: 60px;
    background: var(--ink);
    border-radius: 0 0 5px 5px;
    margin-top: 0;
  }
  /* Mini pole for pattern preview */
  .mini-pole-rings {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0;
  }

  /* =============================================
     SCREEN 1 — LANDING
     ============================================= */
  #screen-landing {
    background: var(--bg-dark);
    color: var(--white);
    position: relative;
    overflow: hidden;
  }
  #screen-landing::before {
    content: '';
    position: absolute;
    inset: 0;
    background: 
      radial-gradient(ellipse at 20% 50%, rgba(217,79,61,0.15) 0%, transparent 60%),
      radial-gradient(ellipse at 80% 20%, rgba(74,124,89,0.1) 0%, transparent 50%);
    pointer-events: none;
  }
  .landing-inner {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 40px 24px;
    position: relative;
    z-index: 1;
    gap: 0;
  }
  .landing-eyebrow {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.8rem;
    font-weight: 600;
    letter-spacing: 0.35em;
    text-transform: uppercase;
    color: rgba(255,255,255,0.4);
    margin-bottom: 16px;
  }
  .landing-title {
    font-family: 'Anton', sans-serif;
    font-size: clamp(3.5rem, 12vw, 9rem);
    letter-spacing: 0.02em;
    text-transform: uppercase;
    line-height: 0.9;
    color: var(--white);
    margin-bottom: 8px;
  }
  .landing-title .accent { color: var(--accent); }
  .landing-sub {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: clamp(1rem, 2.5vw, 1.4rem);
    font-weight: 300;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    color: rgba(255,255,255,0.5);
    margin-bottom: 48px;
  }
  .landing-poles-preview {
    display: flex;
    gap: 20px;
    justify-content: center;
    margin-bottom: 48px;
    opacity: 0.7;
  }
  .landing-btn {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 1.1rem;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    padding: 16px 52px;
    border-radius: 4px;
    border: 2px solid var(--accent);
    background: var(--accent);
    color: var(--white);
    cursor: pointer;
    transition: all var(--transition);
  }
  .landing-btn:hover {
    background: transparent;
    color: var(--accent);
  }
  .landing-footer {
    padding: 20px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 0.15em;
    color: rgba(255,255,255,0.2);
    text-transform: uppercase;
    text-align: center;
  }

  /* =============================================
     SCREEN 2 — PALETTE
     ============================================= */
  #screen-palette { background: var(--bg); }
  .palette-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 16px;
    margin-top: 32px;
  }
  .palette-card {
    border: 2px solid transparent;
    border-radius: var(--radius-md);
    padding: 24px;
    background: var(--white);
    cursor: pointer;
    transition: all var(--transition);
    box-shadow: var(--shadow);
  }
  .palette-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }
  .palette-card.selected {
    border-color: var(--ink);
    box-shadow: 0 0 0 3px rgba(0,0,0,0.08), var(--shadow-lg);
  }
  .palette-name {
    font-family: 'Anton', sans-serif;
    font-size: 1.4rem;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    margin-bottom: 4px;
  }
  .palette-tag {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--ink-light);
    margin-bottom: 16px;
  }
  .palette-swatches {
    display: flex;
    gap: 6px;
    margin-bottom: 12px;
  }
  .swatch {
    flex: 1;
    height: 40px;
    border-radius: 6px;
    border: 1.5px solid rgba(0,0,0,0.08);
    transition: transform var(--transition);
    cursor: pointer;
  }
  .swatch:hover { transform: scale(1.05); }
  .swatch.selected-slot {
    outline: 3px solid var(--ink);
    outline-offset: 2px;
  }
  .palette-selected-mark {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.75rem;
    font-weight: 600;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--ink-mid);
    opacity: 0;
    transition: opacity var(--transition);
  }
  .palette-card.selected .palette-selected-mark { opacity: 1; }

  /* =============================================
     SCREEN 3 — PATTERN
     ============================================= */
  #screen-pattern { background: var(--bg); }
  .pattern-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-top: 32px;
  }
  .pattern-card {
    border: 2px solid transparent;
    border-radius: var(--radius-md);
    padding: 20px 16px;
    background: var(--white);
    cursor: pointer;
    transition: all var(--transition);
    box-shadow: var(--shadow);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
  }
  .pattern-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }
  .pattern-card.selected { border-color: var(--ink); }
  .pattern-name {
    font-family: 'Anton', sans-serif;
    font-size: 1.1rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }
  .pattern-desc {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.78rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--ink-light);
    text-align: center;
  }
  .mini-poles-wrap {
    display: flex;
    gap: 10px;
    justify-content: center;
  }

  /* =============================================
     SCREEN 4 — COLOR ASSIGNMENT
     ============================================= */
  #screen-colors { background: var(--bg); }
  .colors-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 32px;
    margin-top: 24px;
    align-items: start;
  }
  @media (max-width: 700px) {
    .colors-layout { grid-template-columns: 1fr; }
    .poles-hero { order: -1; }
  }
  .slots-panel {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  .slot-row {
    background: var(--white);
    border-radius: var(--radius-md);
    padding: 16px;
    box-shadow: var(--shadow);
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .slot-row-header {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .slot-indicator {
    width: 28px; height: 28px;
    border-radius: 50%;
    border: 2px solid rgba(0,0,0,0.15);
    flex-shrink: 0;
    transition: background-color 0.3s ease;
  }
  .slot-name {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 0.9rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
  }
  .slot-ring-info {
    font-family: 'Barlow', sans-serif;
    font-size: 0.75rem;
    color: var(--ink-light);
    margin-left: auto;
  }
  .slot-swatches {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }
  .slot-swatch {
    width: 32px; height: 32px;
    border-radius: 6px;
    border: 2px solid transparent;
    cursor: pointer;
    transition: all var(--transition);
    position: relative;
  }
  .slot-swatch:hover { transform: scale(1.1); }
  .slot-swatch.active {
    border-color: var(--ink);
    box-shadow: 0 0 0 3px rgba(0,0,0,0.12);
  }
  .poles-hero {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
    position: sticky;
    top: 80px;
  }

  /* =============================================
     SCREEN 5 — FINISH
     ============================================= */
  #screen-finish { background: var(--bg); }
  .finish-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    margin-top: 24px;
    align-items: start;
  }
  @media (max-width: 700px) {
    .finish-layout { grid-template-columns: 1fr; }
  }
  .summary-panel { }
  .summary-title {
    font-family: 'Anton', sans-serif;
    font-size: 1.2rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    margin-bottom: 16px;
  }
  .summary-row {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    background: var(--white);
    border-radius: var(--radius-md);
    margin-bottom: 8px;
    box-shadow: var(--shadow);
  }
  .summary-swatch {
    width: 28px; height: 28px;
    border-radius: 6px;
    border: 1.5px solid rgba(0,0,0,0.1);
    flex-shrink: 0;
  }
  .summary-color-name {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    font-size: 0.9rem;
    letter-spacing: 0.06em;
    flex: 1;
  }
  .summary-counts {
    font-family: 'Barlow', sans-serif;
    font-size: 0.78rem;
    color: var(--ink-mid);
    text-align: right;
  }
  .finish-actions {
    display: flex;
    gap: 12px;
    margin-top: 24px;
    flex-wrap: wrap;
  }
  .congrats-msg {
    font-family: 'Anton', sans-serif;
    font-size: clamp(1.6rem, 4vw, 2.8rem);
    letter-spacing: 0.04em;
    text-transform: uppercase;
    line-height: 1.1;
    margin-bottom: 8px;
  }
  .congrats-sub {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 1rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--ink-mid);
    margin-bottom: 24px;
  }

  /* =============================================
     SHARED LAYOUT
     ============================================= */
  .screen-body {
    flex: 1;
    padding: 32px 32px 80px;
    max-width: 1100px;
    margin: 0 auto;
    width: 100%;
  }
  .screen-header {
    margin-bottom: 8px;
  }
  .bottom-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 40px;
    padding-top: 24px;
    border-top: 1.5px solid rgba(0,0,0,0.08);
  }
  @media (max-width: 600px) {
    .screen-body { padding: 20px 16px 60px; }
    .nav-bar { padding: 14px 16px; }
  }
</style>
</head>
<body>

<!-- =============================================
     SCREEN 1: LANDING
     ============================================= -->
<div id="screen-landing" class="screen active">
  <div class="landing-inner">
    <div class="landing-eyebrow">The Modular Ring System</div>
    <div class="landing-title">twIIgs<br><span class="accent">Poles</span></div>
    <div class="landing-sub">Design your signature look — 38 rings, infinite combinations</div>
    <div class="landing-poles-preview" id="landing-preview"></div>
    <button class="landing-btn" onclick="goTo('palette')">Design Your Poles →</button>
  </div>
  <div class="landing-footer">twIIgs · Modular Ski Pole System</div>
</div>

<!-- =============================================
     SCREEN 2: CHOOSE PALETTE
     ============================================= -->
<div id="screen-palette" class="screen">
  <nav class="nav-bar">
    <div class="logo">twII<span>gs</span></div>
    <div class="nav-steps" id="nav-steps-palette"></div>
    <div style="width:80px"></div>
  </nav>
  <div class="screen-body">
    <div class="screen-header">
      <div class="step-label">Step 1 of 3</div>
      <div class="step-title">Choose a Palette</div>
    </div>
    <div class="palette-grid" id="palette-grid"></div>
    <div class="bottom-nav">
      <button class="btn btn-outline" onclick="goTo('landing')">← Back</button>
      <button class="btn" onclick="goTo('pattern')" id="palette-next">Next: Pattern →</button>
    </div>
  </div>
</div>

<!-- =============================================
     SCREEN 3: CHOOSE PATTERN
     ============================================= -->
<div id="screen-pattern" class="screen">
  <nav class="nav-bar">
    <div class="logo">twII<span>gs</span></div>
    <div class="nav-steps" id="nav-steps-pattern"></div>
    <div style="width:80px"></div>
  </nav>
  <div class="screen-body">
    <div class="screen-header">
      <div class="step-label">Step 2 of 3</div>
      <div class="step-title">Choose a Pattern</div>
    </div>
    <div class="pattern-grid" id="pattern-grid"></div>
    <div class="bottom-nav">
      <button class="btn btn-outline" onclick="goTo('palette')">← Back</button>
      <button class="btn" onclick="goTo('colors')" id="pattern-next">Next: Colors →</button>
    </div>
  </div>
</div>

<!-- =============================================
     SCREEN 4: ASSIGN COLORS
     ============================================= -->
<div id="screen-colors" class="screen">
  <nav class="nav-bar">
    <div class="logo">twII<span>gs</span></div>
    <div class="nav-steps" id="nav-steps-colors"></div>
    <div style="width:80px"></div>
  </nav>
  <div class="screen-body">
    <div class="screen-header">
      <div class="step-label">Step 3 of 3</div>
      <div class="step-title">Assign Your Colors</div>
    </div>
    <div class="colors-layout">
      <div class="slots-panel" id="slots-panel"></div>
      <div class="poles-hero">
        <div class="poles-wrapper" id="poles-live"></div>
      </div>
    </div>
    <div class="bottom-nav">
      <button class="btn btn-outline" onclick="goTo('pattern')">← Back</button>
      <button class="btn btn-accent" onclick="goTo('finish')">Finish Design →</button>
    </div>
  </div>
</div>

<!-- =============================================
     SCREEN 5: FINISH
     ============================================= -->
<div id="screen-finish" class="screen">
  <nav class="nav-bar">
    <div class="logo">twII<span>gs</span></div>
    <div style="width:80px"></div>
    <div style="width:80px"></div>
  </nav>
  <div class="screen-body">
    <div class="congrats-msg">Your Poles<br>Are Ready.</div>
    <div class="congrats-sub">Here's your custom ring configuration</div>
    <div class="finish-layout">
      <div>
        <div class="poles-wrapper" id="poles-final"></div>
      </div>
      <div class="summary-panel">
        <div class="summary-title">Ring Summary</div>
        <div id="summary-rows"></div>
        <div class="finish-actions">
          <button class="btn" onclick="goTo('colors')">← Edit Colors</button>
          <button class="btn btn-accent" onclick="startOver()">Start Over</button>
        </div>
      </div>
    </div>
  </div>
</div>


<script>
/* =============================================
   STATE
   ============================================= */
const state = {
  selectedPalette: 0,
  selectedPattern: 0,
  // slotColors[i] = index into palette colors array (0-4)
  slotColors: [0, 1, 2, 3, 4]
};

/* =============================================
   RING SIZE LAYOUT
   Positions 1-38 (0-indexed: 0-37)
   Big ring positions (0-indexed): 0,10,19,28,34
   ============================================= */
const BIG_POSITIONS = new Set([0, 10, 19, 28, 34]);

function isBig(pos) { return BIG_POSITIONS.has(pos); }

/* =============================================
   // === PALETTE COLORS — EDIT HERE ===
   Each palette: { name, tag, colors: [c1,c2,c3,c4,c5] }
   ============================================= */
const PALETTES = [
  {
    name: "Alpine",
    tag: "Classic Mountain",
    colors: ["#1B3A6B", "#D94F3D", "#F2F0EB", "#4A7C59", "#E8C84A"]
  },
  {
    name: "Storm",
    tag: "Grey Day Vibes",
    colors: ["#2C2C2C", "#6B8FA3", "#C8D8E0", "#A0522D", "#E8E0D0"]
  },
  {
    name: "Neon Pow",
    tag: "Full Send",
    colors: ["#FF2D55", "#00E5FF", "#1A1A2E", "#B537F2", "#F5F500"]
  }
];

/* =============================================
   // === PATTERNS — EDIT HERE ===
   Each pattern: { name, desc, pole1: [...38 slot indices 0-4], pole2: [...38] }
   Slot indices 0-4 map to C1-C5.
   Big ring positions: 0, 10, 19, 28, 34
   ============================================= */
const PATTERNS = [
  {
    name: "Cascade",
    desc: "Flowing repeating rhythm",
    // C1 anchors big rings. Small rings flow C2→C3→C4→C5 cycling, C5 before each big.
    pole1: [
      0,                         // pos 0 (BIG)
      1,2,3,4,1,2,3,4,4,         // pos 1-9
      0,                         // pos 10 (BIG)
      1,2,3,4,1,2,3,4,           // pos 11-18
      0,                         // pos 19 (BIG)
      1,2,3,4,1,2,3,4,4,         // pos 20-28... wait let me recount
      0,                         // pos 28 (BIG)
      1,2,3,4,4,                 // pos 29-33
      0,                         // pos 34 (BIG)
      1,2,3                      // pos 35-37
    ],
    pole2: [
      0,                         // BIG
      2,3,4,1,2,3,4,1,1,
      0,                         // BIG
      2,3,4,1,2,3,4,1,
      0,                         // BIG
      2,3,4,1,2,3,4,1,1,
      0,                         // BIG
      2,3,4,1,1,
      0,                         // BIG
      2,3,4
    ]
  },
  {
    name: "Signal",
    desc: "Bold graphic blocks",
    // Big rings C1. Groups: alternating C2 block, C3 block with C4 accent at midpoint
    pole1: [
      0,
      1,1,1,1,2,2,2,2,3,
      0,
      1,1,1,1,2,2,2,2,
      0,
      1,1,1,1,2,2,2,2,3,
      0,
      1,1,1,3,3,
      0,
      1,2,3
    ],
    pole2: [
      0,
      2,2,2,2,1,1,1,1,4,
      0,
      2,2,2,2,1,1,1,1,
      0,
      2,2,2,2,1,1,1,1,4,
      0,
      2,2,2,4,4,
      0,
      2,1,4
    ]
  },
  {
    name: "Alpine Cross",
    desc: "Symmetrical stripe rhythm",
    // Big rings alternate C1/C5. Smalls: pairs C2,C3 repeating with C4 accents
    pole1: [
      0,
      1,2,1,2,1,2,1,2,3,
      4,
      1,2,1,2,1,2,1,2,
      0,
      1,2,1,2,3,1,2,1,2,
      4,
      1,2,3,1,2,
      0,
      1,2,3
    ],
    pole2: [
      4,
      2,1,2,1,2,1,2,1,3,
      0,
      2,1,2,1,2,1,2,1,
      4,
      2,1,2,1,3,2,1,2,1,
      0,
      2,1,3,2,1,
      4,
      2,1,3
    ]
  }
];

/* Validate all pattern arrays have length 38 — auto-fix if needed */
PATTERNS.forEach(p => {
  while (p.pole1.length < 38) p.pole1.push(0);
  while (p.pole2.length < 38) p.pole2.push(0);
  p.pole1 = p.pole1.slice(0, 38);
  p.pole2 = p.pole2.slice(0, 38);
});

/* =============================================
   COLOR NAMES (for summary)
   ============================================= */
const COLOR_NAMES = [
  ["Cobalt", "Crimson", "Ivory", "Forest", "Amber"],
  ["Obsidian", "Slate Blue", "Ice", "Saddle", "Dune"],
  ["Neon Red", "Cyan", "Night", "Violet", "Electric Yellow"]
];

/* =============================================
   NAVIGATION
   ============================================= */
const SCREENS = ['landing','palette','pattern','colors','finish'];
const STEP_SCREENS = ['palette','pattern','colors'];

function goTo(screenId) {
  SCREENS.forEach(id => {
    const el = document.getElementById('screen-' + id);
    if (el) {
      el.classList.toggle('active', id === screenId);
    }
  });
  if (screenId === 'palette') buildPaletteScreen();
  if (screenId === 'pattern') buildPatternScreen();
  if (screenId === 'colors') buildColorsScreen();
  if (screenId === 'finish') buildFinishScreen();
  window.scrollTo(0,0);
}

function startOver() {
  state.selectedPalette = 0;
  state.selectedPattern = 0;
  state.slotColors = [0,1,2,3,4];
  goTo('landing');
}

/* =============================================
   NAV DOTS
   ============================================= */
function renderNavDots(containerId, currentStep) {
  const el = document.getElementById(containerId);
  if (!el) return;
  el.innerHTML = STEP_SCREENS.map((s, i) => {
    let cls = 'nav-dot';
    if (i < currentStep) cls += ' done';
    if (i === currentStep) cls += ' active';
    return `<div class="${cls}"></div>`;
  }).join('');
}

/* =============================================
   POLE RENDERING
   ============================================= */
function getColor(slotIndex) {
  const palette = PALETTES[state.selectedPalette].colors;
  const colorIdx = state.slotColors[slotIndex];
  return palette[colorIdx];
}

function renderPole(poleArray, size = 'normal') {
  // size: 'normal' | 'mini' | 'large'
  const sizes = {
    normal: { smallW: 36, bigW: 54, h: 11, gap: 1.5, shaft: 8, shaftH: 40 },
    mini:   { smallW: 16, bigW: 24, h: 5,  gap: 0.8, shaft: 4, shaftH: 20 },
    large:  { smallW: 44, bigW: 66, h: 13, gap: 2,   shaft: 10, shaftH: 55 }
  };
  const s = sizes[size] || sizes.normal;

  let html = `<div class="pole-rings" style="gap:${s.gap}px">`;
  poleArray.forEach((slotIdx, i) => {
    const color = getColor(slotIdx);
    const big = isBig(i);
    const w = big ? s.bigW : s.smallW;
    const shadow = `0 1px 3px rgba(0,0,0,0.25), inset 0 1px 0 rgba(255,255,255,0.15)`;
    html += `<div class="ring" style="
      width:${w}px;height:${s.h}px;
      background-color:${color};
      box-shadow:${shadow};
      margin:0 auto;
    "></div>`;
  });
  html += `</div>`;
  html += `<div style="width:${s.shaft}px;height:${s.shaftH}px;background:#1A1A1A;border-radius:0 0 4px 4px;"></div>`;
  return html;
}

/* =============================================
   LANDING PREVIEW
   ============================================= */
function buildLandingPreview() {
  // Use Alpine palette, Cascade pattern as demo
  const el = document.getElementById('landing-preview');
  if (!el) return;
  // Temporarily use alpine for preview
  const origPal = state.selectedPalette;
  const origSlots = [...state.slotColors];
  state.selectedPalette = 0;
  state.slotColors = [0,1,2,3,4];
  
  const p = PATTERNS[0];
  el.innerHTML = `
    <div class="pole-col">
      ${renderPole(p.pole1, 'mini')}
    </div>
    <div class="pole-col">
      ${renderPole(p.pole2, 'mini')}
    </div>
  `;
  state.selectedPalette = origPal;
  state.slotColors = origSlots;
}

/* =============================================
   SCREEN 2: PALETTE
   ============================================= */
function buildPaletteScreen() {
  renderNavDots('nav-steps-palette', 0);
  const grid = document.getElementById('palette-grid');
  grid.innerHTML = PALETTES.map((pal, i) => `
    <div class="palette-card ${state.selectedPalette === i ? 'selected' : ''}" 
         onclick="selectPalette(${i})">
      <div class="palette-name">${pal.name}</div>
      <div class="palette-tag">${pal.tag}</div>
      <div class="palette-swatches">
        ${pal.colors.map(c => `
          <div class="swatch" style="background:${c}" title="${c}"></div>
        `).join('')}
      </div>
      <div class="palette-selected-mark">✓ Selected</div>
    </div>
  `).join('');
}

function selectPalette(idx) {
  state.selectedPalette = idx;
  buildPaletteScreen();
}

/* =============================================
   SCREEN 3: PATTERN
   ============================================= */
function buildPatternScreen() {
  renderNavDots('nav-steps-pattern', 1);
  const grid = document.getElementById('pattern-grid');
  grid.innerHTML = PATTERNS.map((pat, i) => `
    <div class="pattern-card ${state.selectedPattern === i ? 'selected' : ''}"
         onclick="selectPattern(${i})">
      <div class="pattern-name">${pat.name}</div>
      <div class="mini-poles-wrap">
        <div>${renderPole(pat.pole1, 'mini')}</div>
        <div>${renderPole(pat.pole2, 'mini')}</div>
      </div>
      <div class="pattern-desc">${pat.desc}</div>
    </div>
  `).join('');
}

function selectPattern(idx) {
  state.selectedPattern = idx;
  buildPatternScreen();
}

/* =============================================
   SCREEN 4: COLOR ASSIGNMENT
   ============================================= */
function buildColorsScreen() {
  renderNavDots('nav-steps-colors', 2);
  const pat = PATTERNS[state.selectedPattern];
  const pal = PALETTES[state.selectedPalette];

  // Count how many times each slot appears (both poles combined)
  const slotCounts = [0,0,0,0,0];
  [...pat.pole1, ...pat.pole2].forEach(s => slotCounts[s]++);

  // Build slots panel
  const panel = document.getElementById('slots-panel');
  panel.innerHTML = `
    <div style="font-family:'Barlow Condensed',sans-serif;font-size:0.8rem;letter-spacing:0.15em;text-transform:uppercase;color:var(--ink-light);margin-bottom:4px;">
      Tap a color to assign it to each slot
    </div>
    ${[0,1,2,3,4].map(slotIdx => {
      const currentColorIdx = state.slotColors[slotIdx];
      return `
        <div class="slot-row">
          <div class="slot-row-header">
            <div class="slot-indicator" style="background:${pal.colors[currentColorIdx]}"></div>
            <div class="slot-name">Slot C${slotIdx+1}</div>
            <div class="slot-ring-info">${slotCounts[slotIdx]} rings</div>
          </div>
          <div class="slot-swatches">
            ${pal.colors.map((c, ci) => `
              <div class="slot-swatch ${state.slotColors[slotIdx] === ci ? 'active' : ''}"
                   style="background:${c}"
                   onclick="assignSlotColor(${slotIdx}, ${ci})"
                   title="${c}"></div>
            `).join('')}
          </div>
        </div>
      `;
    }).join('')}
  `;

  updateLivePoles();
}

function assignSlotColor(slotIdx, colorIdx) {
  state.slotColors[slotIdx] = colorIdx;
  buildColorsScreen();
}

function updateLivePoles() {
  const pat = PATTERNS[state.selectedPattern];
  const container = document.getElementById('poles-live');
  if (!container) return;
  container.innerHTML = `
    <div class="pole-col">
      <div class="pole-label">Pole 1</div>
      ${renderPole(pat.pole1, 'normal')}
    </div>
    <div class="pole-col">
      <div class="pole-label">Pole 2</div>
      ${renderPole(pat.pole2, 'normal')}
    </div>
  `;
}

/* =============================================
   SCREEN 5: FINISH
   ============================================= */
function buildFinishScreen() {
  const pat = PATTERNS[state.selectedPattern];
  const pal = PALETTES[state.selectedPalette];
  const names = COLOR_NAMES[state.selectedPalette];

  // Render final poles
  const polesEl = document.getElementById('poles-final');
  polesEl.innerHTML = `
    <div class="pole-col">
      <div class="pole-label">Pole 1</div>
      ${renderPole(pat.pole1, 'large')}
    </div>
    <div class="pole-col">
      <div class="pole-label">Pole 2</div>
      ${renderPole(pat.pole2, 'large')}
    </div>
  `;

  // Build ring summary — count by final color
  // Map: colorHex -> { name, small: 0, big: 0 }
  const colorMap = {};

  function countRings(poleArray) {
    poleArray.forEach((slotIdx, pos) => {
      const colorIdx = state.slotColors[slotIdx];
      const hex = pal.colors[colorIdx];
      if (!colorMap[hex]) {
        colorMap[hex] = { name: names[colorIdx], small: 0, big: 0 };
      }
      if (isBig(pos)) colorMap[hex].big++;
      else colorMap[hex].small++;
    });
  }
  countRings(pat.pole1);
  countRings(pat.pole2);

  const summaryEl = document.getElementById('summary-rows');
  summaryEl.innerHTML = Object.entries(colorMap).map(([hex, data]) => `
    <div class="summary-row">
      <div class="summary-swatch" style="background:${hex}"></div>
      <div class="summary-color-name">${data.name}</div>
      <div class="summary-counts">
        ${data.small} small · ${data.big} big
      </div>
    </div>
  `).join('');
}

/* =============================================
   INIT
   ============================================= */
buildLandingPreview();
</script>
</body>
</html>
